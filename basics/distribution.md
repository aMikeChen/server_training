## 「快取」、及「分散」

- 現在來回憶一下 `dev.to` 吧
    1. 將產生的內容持續使用一段時間
        - **快取; cache**
        - 從廣義上來講，快取會被使用在不同的層面上，根據位置、上下文、用途而有所不同
        - 將在 Web 伺服器對 HTTP Request 回應的部分之外，
          每次被產生並取得的內容使用一段時間
            - 與客戶端最接近的部分則由 Web 瀏覽器內容實作，最遠的部分則由伺服器內部實作
    2. 讓在物理上與客戶端較近位置的伺服器來負責
        - **Content Delivery Network, CDN**
            - 將從正式的來源發布的內容根據某種規則進行快取，
              並代替 origin 來回應在物理上較接近的客戶端的取得 Request
        - **邊緣運算; edge computing**
            - 將比 CDN 複雜的處理或需要將大量資料發送到中央伺服器的處理
              讓在物理上與客戶端鄰近的伺服器來完成。能夠分散計算資源與減少通訊頻寬
    3. 存在多個能夠實行同樣處理的伺服器

---

- 雖然最後提到「存在多個能夠實行同樣處理」的伺服器，但依層的不同能力、前提也不同
    - 例如，雖然在物理上與客戶端較近的**邊緣位置; edge location**有多個能夠負責處理的伺服器，
    - 但如果是 CDN，如果邊緣伺服器內沒有所需資料的話，只要向 origin 轉傳 Request 並請求產生主要資訊，然後將其快取起來即可
- 另一方面，與 origin 對應的應用伺服器（群）是什麼呢
    - 如果在這裡無法完成正式的主要處理的話，Application 整體都無法運行
    - 不過，如果只有一台應用伺服器與一台 DB 的話能夠處理多少使用者的請求呢
        - 當然也與機器的性能有關，在 2000 年代初期被視為 **C10k(10,000 connections/clients)問題**
            - 在一台機器上運行的伺服器能夠處理的使用者數量有限，
            - 要提升機器單體的性能（**垂直的**, **scale-up**）也有極限，
            - 不管提升了多少效能，還是難以避免突然的負載增加或硬體故障
- 最主要核心處理的部分也開始有必須具備 **分散式; distribution** 的處理或透過硬體上、軟體上的 **冗余化; redundancy** 來提升 **可用性; availability** 的需求
    - 除了提升機器本身的性能，也希望能透過 **增加機器**（**水平的**，**scale-out**）來提升整體的效能
        - 容易進行 scale-out 的（水平方向的 **可擴展性; scalability**）分散式系統
          能夠更容易地對應隨著服務的成長或短期、長期需求的變化所導致客戶端上的變動

---

- 之前提到很難理解在 **RESTful** 所提倡的 **Stateless**，
  但從這個「分散的必要性」來思考的話應該就稍微能夠接受了
    - 雖然如果是單獨的伺服器的話用 Stateful 也沒關係，不過若是多數的伺服器來負責分散處理的話，則當然會發生「**在伺服器與客戶端之間維持的狀態不會與其他伺服器共享**」
    - 解決這個問題的方法是，
        - 首先，避免在客戶端與伺服器間逐一分配狀態，讓分散處理更容易
            - RESTful 所重視的 **Stateless 導向**
        - 將狀態保存到另外的（能夠快速讀取）DB 裡，讓任何 Application 都能夠參考
            - 使用 **In-memory KVS** 之類的

---

- 因此在 Web 應用的伺服器端開發上，**分散式系統; distributed system** 的開發已經成為不可避免的了
    - 在 Web 出現之前，它就已經被研究過，且出現了許多技術與概念，
    - **負載平衡; load-balancing**
        - 如果負責同樣事情的伺服器同時存在多台，可以將客戶端的 Request 適當地進行分配，
          使每台的負載相同
    - **共識演算法; consensus algorithms**
        - 在多台機器上協作（**叢集; cluster**）使其能夠將資源永久化並對其操作的 DBMS 中，
          可以讓多台機器來負責讀取及寫入，或將請求轉傳給負責的機器
        - 若保存中的資源，或者對機器間叢集狀態的理解有所 **分歧; diverge** 的話會變得很奇怪
        - 叢集內的機器必須盡可能的沒有時間延遲地共享最新的狀態
    - 其他還有很多吧
